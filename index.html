<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚è³¼èˆ‡æŸ¥è©¢ç³»çµ±</title>
    <style>
        :root { --primary: #4285f4; --bg: #f8f9fa; --text: #333; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; color: var(--text); }
        
        /* å°èˆªåˆ—æ¨£å¼ */
        .nav-bar { background: #fff; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .nav-btn {
            background: transparent; border: 2px solid var(--primary); color: var(--primary);
            padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 16px; margin: 0 5px; transition: 0.3s;
        }
        .nav-btn.active, .nav-btn:hover { background: var(--primary); color: white; }

        /* å…§å®¹å®¹å™¨ */
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        
        /* å€å¡Šé¡¯ç¤ºæ§åˆ¶ */
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Google Form RWD */
        .form-container iframe { width: 100%; height: 80vh; border: none; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* æŸ¥è©¢ä»‹é¢æ¨£å¼ (æ²¿ç”¨ä½ åŸæœ¬çš„è¨­è¨ˆä¸¦å¾®èª¿) */
        .search-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; max-width: 450px; margin: 0 auto; }
        input[type="text"] { width: 80%; padding: 12px; margin: 15px 0; border: 2px solid #eee; border-radius: 8px; font-size: 18px; text-align: center; outline: none; }
        input:focus { border-color: var(--primary); }
        .action-btn { background: var(--primary); color: white; border: none; padding: 12px 0; border-radius: 8px; cursor: pointer; font-size: 16px; width: 85%; font-weight: bold; }
        
        /* æŸ¥è©¢çµæœæ¨£å¼ */
        #resultArea { margin-top: 20px; max-width: 450px; margin-left: auto; margin-right: auto; }
        .result-card { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 20px; }
        .data-row { display: flex; border-bottom: 1px solid #f0f0f0; padding: 15px; justify-content: space-between; align-items: center; }
        .data-row:last-child { border-bottom: none; }
        .data-label { color: #666; font-weight: bold; font-size: 14px; }
        .data-value { color: #222; font-size: 15px; text-align: right; }
        
        /* Loading å‹•ç•« */
        .spinner { display: inline-block; width: 18px; height: 18px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; vertical-align: middle; margin-right: 8px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        #loading { display: none; margin-top: 15px; color: #666; }
    </style>
</head>
<body>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchTab('form')">å¡«å¯«è¨‚è³¼å–®</button>
        <button class="nav-btn" onclick="switchTab('query')">è¨‚å–®æŸ¥è©¢</button>
    </div>

    <div class="container">
        <div id="form-section" class="section active">
            <div class="form-container">
                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdXlk7EdJkupKMgFA6zgDUkhw622IXwkYvx5yJGfkaMhRe1ZQ/viewform?embedded=true">Loadingâ€¦</iframe>
            </div>
        </div>

        <div id="query-section" class="section">
            <div class="search-box">
                <h3 style="color: var(--primary); margin-top:0;">ğŸ” è¨‚å–®é€²åº¦æŸ¥è©¢</h3>
                <p style="font-size:14px; color:#888;">è«‹è¼¸å…¥ã€ŒåŒ¯æ¬¾å¸³è™Ÿå¾Œäº”ç¢¼ã€</p>
                <input type="text" id="verifyCode" placeholder="è«‹è¼¸å…¥ 5 ä½æ•¸å­—" maxlength="5">
                <button class="action-btn" onclick="queryData()">é€å‡ºæŸ¥è©¢</button>
                <div id="loading"><div class="spinner"></div> æ­£åœ¨æª¢ç´¢è³‡æ–™...</div>
            </div>
            <div id="resultArea"></div>
        </div>
    </div>

<script>
    // === é é¢åˆ‡æ›é‚è¼¯ ===
    function switchTab(tabName) {
        // éš±è—æ‰€æœ‰å€å¡Š
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        // é¡¯ç¤ºé¸å®šå€å¡Š
        document.getElementById(tabName + '-section').classList.add('active');
        
        // æŒ‰éˆ•æ¨£å¼æ›´æ–°
        const btnText = tabName === 'form' ? 'å¡«å¯«è¨‚è³¼å–®' : 'è¨‚å–®æŸ¥è©¢';
        const buttons = document.querySelectorAll('.nav-btn');
        buttons.forEach(btn => {
            if(btn.innerText === btnText) btn.classList.add('active');
        });
    }

    // === æŸ¥è©¢ç³»çµ±é‚è¼¯ ===
    // æ³¨æ„ï¼šè«‹ç¢ºä¿æ­¤ URL æ˜¯æ‚¨æœ€æ–°çš„ Apps Script éƒ¨ç½²ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxN9W9BPvkQ5riAjS2ROvOF8T2BRIMmfKIfmpp-FBsW2IE7Da5cWCWEJALkkn7x6Eqx/exec";

    async function queryData() {
        const codeInput = document.getElementById('verifyCode');
        const code = codeInput.value.trim();
        const resultArea = document.getElementById('resultArea');
        const loading = document.getElementById('loading');
        
        if (code.length < 5) { alert("è«‹è¼¸å…¥å®Œæ•´çš„ 5 ä½æ•¸å­—"); return; }
        
        resultArea.innerHTML = '';
        loading.style.display = 'block';

        try {
            // ä½¿ç”¨ fetch ç™¼é€è«‹æ±‚
            // æ¨¡å¼èªªæ˜ï¼štext/plain æ˜¯ç‚ºäº†é¿å… CORS é æª¢è«‹æ±‚ (Preflight)ï¼Œé€™æ˜¯ GAS API çš„å¸¸è¦‹æŠ€å·§
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ code: code }),
                headers: { "Content-Type": "text/plain;charset=utf-8" }
            });
            
            const res = await response.json();

            if (res.status === 'success') {
                renderResult(res.data);
                codeInput.value = '';
            } else {
                alert(res.message);
            }
        } catch (err) {
            console.error(err);
            alert("é€£ç·šéŒ¯èª¤ï¼šè«‹ç¢ºèªç¶²è·¯ï¼Œæˆ–æª¢æŸ¥ Apps Script éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äººã€ã€‚");
        } finally {
            loading.style.display = 'none';
        }
    }

    function renderResult(data) {
        const container = document.getElementById('resultArea');
        let html = '<div class="result-card">';
        data.forEach(item => {
            html += `
            <div class="data-row">
                <div class="data-label">${item.label}</div>
                <div class="data-value">${(item.value !== "" && item.value !== null) ? item.value : "-"}</div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    }
</script>

</body>
</html>
